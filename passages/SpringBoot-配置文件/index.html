<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>SpringBoot 配置文件 - Virgil’s Blog</title><meta description="1. yaml 语法 基本语法：  使用缩进表示层级关系 缩进使用空格 大小写敏感  123server:    port: 8080    address: www.example.com"><meta property="og:type" content="blog"><meta property="og:title" content="SpringBoot 配置文件"><meta property="og:url" content="http://virgilchen97.github.io/passages/SpringBoot-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"><meta property="og:site_name" content="Virgil’s Blog"><meta property="og:description" content="1. yaml 语法 基本语法：  使用缩进表示层级关系 缩进使用空格 大小写敏感  123server:    port: 8080    address: www.example.com"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-12)SpringBoot-配置文件.md/2020-06-12-18-09-24.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-12)SpringBoot-配置文件.md/2020-06-12-21-32-51.png"><meta property="article:published_time" content="2020-06-12T22:49:12.000Z"><meta property="article:modified_time" content="2020-06-26T20:59:31.664Z"><meta property="article:author" content="VirgilChen"><meta property="article:tag" content="Spring"><meta property="article:tag" content="SpringBoot"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/(2020-06-12)SpringBoot-配置文件.md/2020-06-12-18-09-24.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://virgilchen97.github.io/passages/SpringBoot-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"},"headline":"Virgil’s Blog","image":["http://virgilchen97.github.io/img/(2020-06-12)SpringBoot-配置文件.md/2020-06-12-18-09-24.png","http://virgilchen97.github.io/img/(2020-06-12)SpringBoot-配置文件.md/2020-06-12-21-32-51.png"],"datePublished":"2020-06-12T22:49:12.000Z","dateModified":"2020-06-26T20:59:31.664Z","author":{"@type":"Person","name":"VirgilChen"},"description":"1. yaml 语法\r 基本语法：\r \r 使用缩进表示层级关系\r 缩进使用空格\r 大小写敏感\r \r 123server:    port: 8080    address: www.example.com"}</script><link rel="canonical" href="http://virgilchen97.github.io/passages/SpringBoot-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="Virgil’s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-06-12T22:49:12.000Z" title="2020-06-12T22:49:12.000Z">2020-06-12</time><span class="level-item"><a class="link-muted" href="/categories/%E6%89%BE%E5%B7%A5%E4%BD%9C/">找工作</a></span><span class="level-item">12 分钟 读完 (大约 1754 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">SpringBoot 配置文件</h1><div class="content"><h1 id="yaml-语法">1. yaml 语法</h1>
<p><strong>基本语法</strong>：</p>
<ul>
<li>使用缩进表示层级关系</li>
<li>缩进使用空格</li>
<li>大小写敏感</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">address:</span> <span class="string">www.example.com</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p><strong>支持的数据结构</strong></p>
<ol type="1">
<li><p>字面量</p>
<p>字符串无需添加双引号 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">address:</span> <span class="string">www.example.com</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>对象和Map</p>
<p>多行写法 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">people:</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">Frank</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">18</span></span><br><span class="line">    <span class="attr">gender:</span> <span class="string">male</span></span><br></pre></td></tr></table></figure></p>
<p>行内写法 多行写法 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">people:</span> <span class="string">&#123;name:</span> <span class="string">Frank,</span> <span class="attr">age:</span> <span class="number">18</span><span class="string">,</span> <span class="attr">gender:</span> <span class="string">male&#125;</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>数组</p>
<p>多行写法 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">animals:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">dog</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">pig</span></span><br></pre></td></tr></table></figure></p>
<p>行内写法 多行写法 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">people:</span> <span class="string">&#123;cat,</span> <span class="string">dog,</span> <span class="string">pig&#125;</span></span><br></pre></td></tr></table></figure></p></li>
</ol>
<h1 id="获取配置文件的值-configurationproperties">2. 获取配置文件的值 （<span class="citation" data-cites="ConfigurationProperties">@ConfigurationProperties</span>）</h1>
<p>首先我们在 <code>com.cyf.demo.bean</code> 包下创建一个新的 <code>Hero</code> 类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略了 getter, setter和toString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 测试字面量的获取</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> atk;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> def;</span><br><span class="line">    <span class="keyword">private</span> Boolean isAlive;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试Map的获取</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; abilities;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试数组的获取</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; equipments;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 测试对象的获取</span></span><br><span class="line">    <span class="keyword">private</span> Weapon weapon;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样的我们创建 <code>Hero</code> 类包含的 <code>Weapon</code> 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略了 getter, setter和toString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Weapon</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> atk;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> def;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时我们在 <code>src/main/resources</code> 文件夹下创建 <code>application.yml</code>，并添加以下内容, 可以发现与我们定义的 <code>Hero</code> 类的属性完全一致：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Hero:</span> </span><br><span class="line">  <span class="attr">name:</span> <span class="string">Ashe</span></span><br><span class="line">  <span class="attr">atk:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">def:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">isAlive:</span> <span class="string">ture</span></span><br><span class="line">  <span class="attr">abilities:</span></span><br><span class="line">    <span class="attr">bomb:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">shotgun:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">weapon:</span></span><br><span class="line">    <span class="attr">atk:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">def:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>然后我们为 <code>Hero</code> 类添加 <code>@ConfigurationProperties</code> 注解。它可以讲配置文件中的属性值和类中对应的属性值联系起来。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">// 启用配置文件功能，类本身必须是一个Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"Hero"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时我们得到了一条提示：</p>
<p><img src="/img/(2020-06-12)SpringBoot-配置文件.md/2020-06-12-18-09-24.png" /></p>
<p>这是因为我们并没有在 Maven 中添加 SpringBoot 的注解处理器，根据官方文档，我们在 <code>pom.xml</code> 中添加：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后重新运行一遍我们的 <code>DemoApplication</code>, Annotation Processor 就会正常工作了, 编写配置文件的时候Idea也会进行提示。</p>
<p>接下来我们修改 <code>src/test/java/com/cyf/demo/DemoApplicationTests.java</code>, 编写一个单元测试来测试我们配置文件的值是否注入。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DemoApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 自动注入Hero类</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Hero hero;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(hero);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行测试，我们发现输出为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hero&#123;name&#x3D;&#39;Ashe&#39;, atk&#x3D;20, def&#x3D;20, isAlive&#x3D;null, abilities&#x3D;&#123;bomb&#x3D;20, shotgun&#x3D;10&#125;, equipments&#x3D;null, weapon&#x3D;Weapon&#123;atk&#x3D;20, def&#x3D;0&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>也就是说Spring成功的获取了我们配置文件中的值并注入到了对应的类中。</p>
<h1 id="获取配置文件的值-value">3. 获取配置文件的值 （<span class="citation" data-cites="Value">@Value</span>）</h1>
<p>使用 <code>@Value</code> 注解和在之前的 Spring 中配置文件的 <code>&lt;bean&gt;</code> 便签中进行配置基本相同，原来我们会这样配置一个bean：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"Hero"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"()"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>在value处Spring支持三种类型： 1. 字面量 2. <code>${key}</code> 从配置文件中获取key对应的value 3. <code>#{SpEL}</code> 运算</p>
<p>因此 <code>@Value</code> 注解同样支持这三种类型。作为测试，我们修改Hero类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 省略了 getter, setter和toString</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//@ConfigurationProperties(prefix = "hero") 不再使用 ConfigurationProperties</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;hero.name&#125;"</span>) <span class="comment">// 通过key获取value</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"#&#123;10*2&#125;"</span>) <span class="comment">// 计算</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> atk;</span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"20"</span>) <span class="comment">// 字面量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> def;</span><br><span class="line">    <span class="keyword">private</span> Boolean isAlive;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; abilities;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; equipments;</span><br><span class="line">    <span class="keyword">private</span> Weapon weapon;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>重新运行单元测试，输出为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hero&#123;name&#x3D;&#39;Ashe&#39;, atk&#x3D;20, def&#x3D;20, isAlive&#x3D;null, abilities&#x3D;null, equipments&#x3D;null, weapon&#x3D;null&#125;</span><br></pre></td></tr></table></figure>
<p>可以发现我们注解了的三个值都成功的注入到了对象中。</p>
<h1 id="value-和-configurationproperties-的区别">4. <span class="citation" data-cites="Value">@Value</span> 和 <span class="citation" data-cites="ConfigurationProperties">@ConfigurationProperties</span> 的区别</h1>
<table>
<thead>
<tr class="header">
<th></th>
<th><code>@Value</code></th>
<th><code>@ConfigurationProperties</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>功能</td>
<td>批量注入配置文件属性</td>
<td>单个属性注入</td>
</tr>
<tr class="even">
<td>松散绑定*</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr class="odd">
<td>SpEL</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr class="even">
<td>复杂类型</td>
<td>支持</td>
<td>不支持</td>
</tr>
</tbody>
</table>
<p>*松散绑定指的是 <code>lastName</code> = <code>last-name</code></p>
<h1 id="propertysource-和-importresource">5. <span class="citation" data-cites="PropertySource">@PropertySource</span> 和 <span class="citation" data-cites="ImportResource">@ImportResource</span></h1>
<p>如果所有配置都写在 <code>application.properties</code> 里，会显得配置文件过于复杂或者庞大。此时我们可以使用 <code>@PropertySource</code> 来指定要读取的配置文件。刚才我们把所有的 <code>Person</code> 类的属性写在了 <code>application.yml</code> 里。现在我们可以把内容改成 <code>properties</code> 的格式，然后放入 <code>person.properties</code> 文件中：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">hero.name</span>=<span class="string">Ashe</span></span><br><span class="line"><span class="meta">hero.atk</span>=<span class="string">20</span></span><br><span class="line"><span class="meta">hero.def</span>=<span class="string">20</span></span><br><span class="line"><span class="meta">hero.isAlive</span>=<span class="string">ture</span></span><br><span class="line"><span class="meta">hero.abilities.bomb</span>=<span class="string">20</span></span><br><span class="line"><span class="meta">hero.abilities.shotgun</span>=<span class="string">10</span></span><br><span class="line"><span class="meta">hero.weapon.atk</span>=<span class="string">20</span></span><br><span class="line"><span class="meta">hero.weapon.def</span>=<span class="string">0</span></span><br></pre></td></tr></table></figure>
<p>然后再 <code>Hero</code> 类前方添加如下注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource</span>(<span class="string">"classpath:person.properties"</span>) <span class="comment">// 使用 person.properties 作为本类的配置文件</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"Hero"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hero</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配置一样可以成功注入类中。</p>
<p>而 <code>@ImportResource</code> 则是用来加载自定义配置文件用的，如果我们在 <code>resource</code> 目录下添加一个 <code>beans.xml</code> 文件，SpringBoot 不会自动导入这个配置文件，我们需要在 <code>DemoApplications</code> 中加入注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource</span>(locations=&#123;<span class="string">"classpath:bean.xml"</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>SpringBoot 才会识别这个配置文件。但是SpringBoot并不推荐我们这样添加新的组件，推荐使用<strong>全注解</strong>的方式来添加组件。</p>
<p>首先在我们的 <code>com.cyf.demo</code> 包下创建一个新的 <code>service</code> 包。然后编写一个 <code>HelloService</code> 类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.cyf.demo.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"This is a hello from hello service"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们尝试在单元测试中注入 <code>HelloService</code> 时， 会发选 Idea 已经提示我们无法找到这个bean：</p>
<p><img src="/img/(2020-06-12)SpringBoot-配置文件.md/2020-06-12-21-32-51.png" /></p>
<p>通常我们会编写一个配置文件来导入这个包，但是现在我们通过配置类的方式。在我们的 <code>com.cyf.demo</code> 包下创建一个新的 <code>config</code> 包，新建 <code>HelloConfig</code> 类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 表明这是一个配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloConfig</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 等同于原本的&lt;bean&gt; 标签，方法名就是原本的bean id</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloService <span class="title">helloService</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HelloService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时我们再运行单元测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">This is a hello from hello service</span><br></pre></td></tr></table></figure>
<p>这个组件就通过我们的配置类加载进来了。</p>
<h1 id="配置文件占位符">6. 配置文件占位符</h1>
<p>共有两种，一种是随机数占位符，还有一种时属性配置占位符。我们分别举例。</p>
<p>之前我们的 <code>application.yml</code> 中指定了 <code>Hero</code> 类型的一些属性，现在我们可以向其中添加一些占位符：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hero:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">Ashe$&#123;random.uuid&#125;</span> <span class="comment"># 生成随机UUID</span></span><br><span class="line">  <span class="attr">atk:</span> <span class="string">$&#123;random.int&#125;</span> <span class="comment"># 生成随机整数</span></span><br><span class="line">  <span class="attr">def:</span> <span class="number">20</span></span><br><span class="line">  <span class="attr">isAlive:</span> <span class="string">ture</span></span><br><span class="line">  <span class="attr">abilities:</span></span><br><span class="line">    <span class="attr">bomb:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">shotgun:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">weapon:</span></span><br><span class="line">    <span class="attr">atk:</span> <span class="string">$&#123;hero.atk&#125;</span> <span class="comment"># 使用存在的属性配置</span></span><br><span class="line">    <span class="attr">def:</span> <span class="string">$&#123;hero.at:10&#125;</span> <span class="comment"># 若属性不存在则可以使用冒号指定默认值</span></span><br></pre></td></tr></table></figure>
<p>此时我们再次运行单元测试：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hero&#123;name&#x3D;&#39;Ashe8a1189c9-2740-4b6e-b85b-14de42bdfb42&#39;, atk&#x3D;-156092609, def&#x3D;20, isAlive&#x3D;null, abilities&#x3D;&#123;bomb&#x3D;20, shotgun&#x3D;10&#125;, equipments&#x3D;null, weapon&#x3D;Weapon&#123;atk&#x3D;-499134195, def&#x3D;0&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>可以观察到生成的UUID，随机整数的ATK，以及和ATK相同的Waepon ATK。由于 <code>hero.at</code> 这个属性不存在，<code>weapon.def</code> 被设置成了默认值10。</p>
<h1 id="profile">7. Profile</h1>
<p>在实际开发过程中经常牵涉到不同环境的切换（生产/开发/测试）。共有两种方法可以实现多profile。</p>
<p>当使用properties文件时，我们可以使用 <code>application-{profile name}.properties</code> 来实现多profile配置，例如 <code>application-dev.properties</code> 代表开发环境。</p>
<p>当使用yaml文件时，我们可以使用yaml的文档块来实现多profile，例如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span> </span><br><span class="line">    <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">    <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span> </span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">spring:</span> </span><br><span class="line">    <span class="attr">profiles:</span> <span class="string">prod</span></span><br></pre></td></tr></table></figure>
<p>在启动项目时，加上 <code>-spring.profiles.active={profile name}</code> 即可在profile之间切换。</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Spring/">Spring</a><a class="link-muted mr-2" rel="tag" href="/tags/SpringBoot/">SpringBoot</a></div><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5eebe43792e11671" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/passages/SpringBoot-%E6%97%A5%E5%BF%97/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">SpringBoot 日志</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/passages/SpringBoot-%E5%85%A5%E9%97%A8/"><span class="level-item">SpringBoot 入门</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><!--!--></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="Virgil’s Blog" height="28"></a><p class="size-small"><span>&copy; 2020 VirgilChen</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://VirgilChen97.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>