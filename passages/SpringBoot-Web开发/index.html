<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>SpringBoot Web 开发（一） - Virgil’s Blog</title><meta description="在写这篇笔记之前我也有很多思考，我参考的教程中有很多SpringMVC以及JSP，模板引擎的内容。貌似现在的开发大环境下，后端需要兼顾手机App和网页版共同的请求，前后端分离是大的趋势。但是我仍然准备学习一下传统的服务器端渲染的相关技术。一方面是感受一下技术的演进，另一方面是前后端分离不利于SEO（Serach Engine Optimization），很多现有的产品仍然使用服务器渲染的原因就是搜"><meta property="og:type" content="blog"><meta property="og:title" content="SpringBoot Web 开发（一）"><meta property="og:url" content="http://virgilchen97.github.io/passages/SpringBoot-Web%E5%BC%80%E5%8F%91/"><meta property="og:site_name" content="Virgil’s Blog"><meta property="og:description" content="在写这篇笔记之前我也有很多思考，我参考的教程中有很多SpringMVC以及JSP，模板引擎的内容。貌似现在的开发大环境下，后端需要兼顾手机App和网页版共同的请求，前后端分离是大的趋势。但是我仍然准备学习一下传统的服务器端渲染的相关技术。一方面是感受一下技术的演进，另一方面是前后端分离不利于SEO（Serach Engine Optimization），很多现有的产品仍然使用服务器渲染的原因就是搜"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-23-28.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-28-09.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-54-59.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-56-21.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-15-23-50.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-12-59-16.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-19-58-42.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-02-24.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-11-01.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-28-02.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-54-06.png"><meta property="og:image" content="http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-17-22-27-02.png"><meta property="og:image" content="http://virgilchen97.github.io/passages/SpringBoot-Web%E5%BC%80%E5%8F%91/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-17-22-34-00.png"><meta property="article:published_time" content="2020-06-16T18:03:37.000Z"><meta property="article:modified_time" content="2020-06-26T20:59:31.670Z"><meta property="article:author" content="VirgilChen"><meta property="article:tag" content="Spring"><meta property="article:tag" content="SpringBoot"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-23-28.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://virgilchen97.github.io/passages/SpringBoot-Web%E5%BC%80%E5%8F%91/"},"headline":"Virgil’s Blog","image":["http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-23-28.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-28-09.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-54-59.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-56-21.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-15-23-50.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-12-59-16.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-19-58-42.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-02-24.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-11-01.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-28-02.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-54-06.png","http://virgilchen97.github.io/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-17-22-27-02.png","http://virgilchen97.github.io/passages/SpringBoot-Web%E5%BC%80%E5%8F%91/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-17-22-34-00.png"],"datePublished":"2020-06-16T18:03:37.000Z","dateModified":"2020-06-26T20:59:31.670Z","author":{"@type":"Person","name":"VirgilChen"},"description":"在写这篇笔记之前我也有很多思考，我参考的教程中有很多SpringMVC以及JSP，模板引擎的内容。貌似现在的开发大环境下，后端需要兼顾手机App和网页版共同的请求，前后端分离是大的趋势。但是我仍然准备学习一下传统的服务器端渲染的相关技术。一方面是感受一下技术的演进，另一方面是前后端分离不利于SEO（Serach Engine Optimization），很多现有的产品仍然使用服务器渲染的原因就是搜"}</script><link rel="canonical" href="http://virgilchen97.github.io/passages/SpringBoot-Web%E5%BC%80%E5%8F%91/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script></head><body class="is-1-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="Virgil’s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-12"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2020-06-16T18:03:37.000Z" title="2020-06-16T18:03:37.000Z">2020-06-16</time><span class="level-item"><a class="link-muted" href="/categories/%E6%89%BE%E5%B7%A5%E4%BD%9C/">找工作</a></span><span class="level-item">28 分钟 读完 (大约 4236 个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">SpringBoot Web 开发（一）</h1><div class="content"><p>在写这篇笔记之前我也有很多思考，我参考的教程中有很多SpringMVC以及JSP，模板引擎的内容。貌似现在的开发大环境下，后端需要兼顾手机App和网页版共同的请求，前后端分离是大的趋势。但是我仍然准备学习一下传统的服务器端渲染的相关技术。一方面是感受一下技术的演进，另一方面是前后端分离不利于SEO（Serach Engine Optimization），很多现有的产品仍然使用服务器渲染的原因就是搜索引擎。虽然现在可能会有一些更加成熟的方案（nodejs作为中间层），但是咱们还是一步一步来。第一部分我们熟悉模板引擎，静态资源映射，并实现简单的登录功能。</p>
<a id="more"></a>
<h1 id="spring-boot-静态资源映射">Spring Boot 静态资源映射</h1>
<p>在以往的SpringMVC中，我们会将静态资源文件储存在WEBAPP中，但是在SpringBoot中则有所不同。开始前使用 Spring Initializer 新建一个 restful-api 的项目。勾选 web, Spring Data JPA, MySQL 模块.</p>
<h2 id="webjars-jar包形式存在的静态资源">1. <code>/webjars/**</code>: jar包形式存在的静态资源</h2>
<p>所有对于 <code>/webjars/**</code> 的访问都会去 <code>classpath:/META-INF/resources/webjars/</code> 下去找相应的资源。你可以通过 <a href="https://www.webjars.org/">webjars</a> 网站获取相应webjar的maven依赖，例如 <code>jQuery</code> 的依赖如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--引入Jquery--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>你同样可以找到其他流行的web框架例如 Bootstrap, react 的webjar。作为测试我们吧 <code>jQuery</code> 的依赖添加到我们的项目中。在Idea的External Libraries中我们可以看到 <code>jQuery</code> 的 webjar 结构如下：</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-23-28.png" /></p>
<p>所以如果此时我们启动项目，直接在浏览器访问 <code>localhost:8080/webjars/jquery/3.5.1/jquery.js</code> 我们便可以获取 <code>jquery.js</code> 这个文件的内容：</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-28-09.png" /></p>
<h2 id="静态资源文件夹">2. <code>/**</code> 静态资源文件夹</h2>
<p>所有对于 <code>/**</code> 路径的访问，如果没有被 <code>@RequestMapping</code> 绑定，那么SpringBoot会默认从一下文件夹获取：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"classpath:/META-INF/resources"</span></span><br><span class="line"><span class="string">"classpath:/resources"</span>  <span class="comment">//注意这个不是我们创建工程中已经存在的resources，工程中已存在的resource实际是根目录</span></span><br><span class="line"><span class="string">"classpath:/static"</span></span><br><span class="line"><span class="string">"classpath:/public"</span></span><br><span class="line"><span class="string">"/"</span></span><br></pre></td></tr></table></figure>
<p>例如我们现在在 <code>resource/static</code> 文件夹下创建一个test.html:</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-54-59.png" /></p>
<p>内容为：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>此时我们访问 <code>localhost:8080/test.html</code> ：</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-14-56-21.png" /></p>
<p>可以看到资源成功访问，载入了test.html页面。</p>
<h2 id="欢迎页映射index.html">3. 欢迎页映射：index.html</h2>
<p>如果我们直接访问 <code>localhost:8080/</code>，那么 SpringBoot 就会去每个资源文件夹下寻找index.html并返回，把刚才我们创建的 HTML 文件改名为 <code>index.html</code>，在浏览器中访问 <code>localhost:8080/</code> ，可以发现页面依然成功载入了。</p>
<h2 id="favicon">4. favicon</h2>
<p>定义网页图标，所有静态资源文件夹下的favicon.ico</p>
<h1 id="springboot-模板引擎">SpringBoot 模板引擎</h1>
<p>JSP, velocity, Thymeleaf都是模板引擎。他们可以讲模板与数据结合，并生成最终的页面。SpringBoot 推荐的模板引擎时Thymeleaf。修改 pom.xml 引入 thymeleaf：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="demo">Demo</h2>
<p>Thymeleaf 使用起来十分简单，我们只需要吧作为模板的HTML文件放在 <code>templates</code> 文件夹下，thymeleaf就会自动为我们渲染页面。我们先从一个简单的例子出发，首先在 <code>controller</code> 包下新建一个 <code>HelloController</code> 类，内容如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span> <span class="comment">// 不是RestContoller，因为我们返回的不再是responsebody</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/success"</span>) <span class="comment">// 处理 /success请求</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">success</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"success"</span>; <span class="comment">// 返回模板页面名称</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们在 <code>resource/template</code> 文件夹下创建一个 <code>success.html</code>，内容如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Success!<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is a success message<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行项目，访问 <code>localhost:8080/success</code>:</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-14-15-23-50.png" /></p>
<p>更加具体的语法可以参考 <a href="https://www.thymeleaf.org/documentation.html">Thymeleaf 官方文档</a></p>
<h1 id="crud-实例">CRUD 实例</h1>
<h2 id="引入静态资源">引入静态资源</h2>
<p>将我们的 html, css, js 文件导入项目。完成后目录的结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">├── main</span><br><span class="line">│   ├── java</span><br><span class="line">│   │   └── com</span><br><span class="line">│   │       └── cyf</span><br><span class="line">│   │           └── restfulapi</span><br><span class="line">│   │               └── RestfulApiApplication.java</span><br><span class="line">│   └── resources</span><br><span class="line">│       ├── application.properties</span><br><span class="line">│       ├── static</span><br><span class="line">│       │   └── asserts</span><br><span class="line">│       │       ├── css</span><br><span class="line">│       │       │   ├── bootstrap.min.css</span><br><span class="line">│       │       │   ├── dashboard.css</span><br><span class="line">│       │       │   └── signin.css</span><br><span class="line">│       │       ├── img</span><br><span class="line">│       │       │   └── bootstrap-solid.svg</span><br><span class="line">│       │       └── js</span><br><span class="line">│       │           ├── bootstrap.min.js</span><br><span class="line">│       │           ├── Chart.min.js</span><br><span class="line">│       │           ├── feather.min.js</span><br><span class="line">│       │           ├── jquery-3.2.1.slim.min.js</span><br><span class="line">│       │           └── popper.min.js</span><br><span class="line">│       └── templates</span><br><span class="line">│           ├── 404.html</span><br><span class="line">│           ├── dashboard.html</span><br><span class="line">│           ├── index.html</span><br><span class="line">│           ├── list.html</span><br><span class="line">└── test</span><br><span class="line">    └── java</span><br><span class="line">        └── com</span><br><span class="line">            └── cyf</span><br><span class="line">                └── restfulapi</span><br><span class="line">                    └── RestfulApiApplicationTests.java</span><br></pre></td></tr></table></figure>
<p>根据我们之前学习的静态资源映射规则，现在我们启动项目，访问 <code>lcoalhost:8080</code>，可以发现首页已经显示出来了：</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-12-59-16.png" /></p>
<p>目前我们的HTML文件名称就叫做 index.html，那么如果我们想要让首页默认是其他的html文件怎么办呢？例如我们讲我们的<code>index.html</code> 更改为 <code>login.html</code>。 简单的方法是我们可以在controller中写一个方法并且 <code>@RequestMapping("/")</code> 然后return需要作为默认页面的页面。还有一种方法是我们可以通过一个配置类来配置 SpringMVC，修改默认的主页。在 config 包下新建 <code>MyMvcConfig</code> 类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">// 申明这是一个配置类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        将我们定义的 WebMvcConfigurer 作为组件加入到容器中，SpringBoot进行自动配置的过程中，如果某个Bean在容器中已经存在，那么SpringBoot就会跳过该Bean的默认自动配置，在这里我们用我们自己的 webMvcConfigurer 替换了默认的 bean</span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">     <span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">         WebMvcConfigurer webMvcConfigurer = <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">                registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">                 registry.addViewController(<span class="string">"/index.htm;"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;;</span><br><span class="line">         <span class="keyword">return</span> webMvcConfigurer;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>访问项目地址，你会发现默认载入的已经是 <code>login.html</code> 了。接下来还有的问题是咱们的几个html页面都是基于 Bootstrap 实现的，我们可以发现在我们的静态资源文件夹中也有和Bootstrap相关的js文件。我们之前讲过我们可以通过webjar的形式来引入静态资源，因此我们同样可以通过webjar来引入Bootstrap的相关依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>接下来我们打开 login.html 修改 html 标签:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--启用模板引擎的智能提示--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>接下来我们发现 login.html 引用了我们 <code>asserts/css</code> 下的css文件，现在我们就可以通过模板引擎将这里修改为我们引入的webjar：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/bootstrap.min.css"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/webjars/bootstrap/4.5.0/css/bootstrap.css&#125;"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Custom styles for this template --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引用外部CSS或者用到相对路径都要用模板引擎替换，这样即使改变项目根目录地址，新的地址也会自动被模板引擎填写--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"asserts/css/signin.css"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/asserts/css/signin.css&#125;"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>对所有的html文件进行修改，重新访问项目地址，一切正常。</p>
<h2 id="国际化">国际化</h2>
<p>现实生活中我们有很多场景下需要提供App的国际化支持，SpringBoot自然也包含了这个特性。我们可以通过国际化配置文件来实现国际化。我们用登录页面 <code>login.html</code> 举例。首先，在 recourse 下创建 <code>i18n</code> 文件夹，然后添加三个文件 <code>login.properties</code>, <code>login_en_US.properties</code> 和 <code>login_zh_CN.properties</code>。如果需要支持更多的语言，则是添加更多的 <code>login_语言代码_区域代码.properties</code>。创建完成后，你会发现 Idea 已经自动将我们的配置文件归为了一个 Bundle：</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-19-58-42.png" /></p>
<p>接下来选中 Bundle，并点击右下方的 Resource Bundle</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-02-24.png" /></p>
<p>为登录页面的每一处文本添加对应的配置：</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-11-01.png" /></p>
<p>修改好了之后，我们需要告诉SpringBoot我们的配置文件的位置，让SpringBoot使用我们的配置文件，因此在application.yml中添加:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">messages:</span></span><br><span class="line">    <span class="attr">basename:</span> <span class="string">i18n.login</span></span><br></pre></td></tr></table></figure>
<p>值得注意的是 <code>spring.messages.basename</code> 自动配置的默认值是 <code>messages</code> 也就是说如果将 <code>messages.properties</code> 直接放在 resource 目录下，无须进行任何配置即可使用。对于较小规模的项目来说较为实用。做好了国际化相关的配置文件后，我们需要在模板中读取相应字段的值。以 Please Sign in 这个区域为例，修改 HTML 如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h3 mb-3 font-weight-normal"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.prompt&#125;"</span>&gt;</span>Please sign in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样我们的模板引擎便会根据语言将标签内的值替换成 <code>login.prompt</code> 的对应语言的文本，如果浏览器的默认语言是中文的话，页面中的对应文本就会变成中文：</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-28-02.png" /></p>
<p>现在我们的页面会根据浏览器的语言设置切换语言。但是我们如后让用户通过点击来选择语言呢？在SpringBoot中，获取需要什么语言是由 <code>LocaleResolver</code> 组件来实现的，我们可以查看 <code>WebMvcAutoConfigurator</code> 类来查看这个组件的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.mvc"</span>, name = <span class="string">"locale"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">    &#125;</span><br><span class="line">    AcceptHeaderLocaleResolver localeResolver = <span class="keyword">new</span> AcceptHeaderLocaleResolver();</span><br><span class="line">    localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">    <span class="keyword">return</span> localeResolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到默认的 LocaleResolver 是通过浏览器发送的请求的请求头中的 <code>Accept-Language</code> 来决定语言。为了实现我们的目标，我们可以讲需要的语言作为请求参数，实现一个我们自己的 <code>LocaleResolver</code>，我们在 component 包下建立新的类 <code>MyLocaleResolver</code> 并实现 <code>LocaleResolver</code> 接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest httpServletRequest)</span> </span>&#123;</span><br><span class="line">        String lang = httpServletRequest.getParameter(<span class="string">"lang"</span>); <span class="comment">// 获取请求参数lang</span></span><br><span class="line">        Locale locale = Locale.getDefault(); <span class="comment">// 获取系统默认的Locale</span></span><br><span class="line">        <span class="keyword">if</span>(lang != <span class="keyword">null</span> &amp;&amp; lang.length() !=<span class="number">0</span>)&#123; <span class="comment">// 若包含请求参数</span></span><br><span class="line">            String[] splitted = lang.split(<span class="string">"-"</span>); <span class="comment">// "en_US" -&gt; ["en", "US"]</span></span><br><span class="line">            locale = <span class="keyword">new</span> Locale(splitted[<span class="number">0</span>], splitted[<span class="number">1</span>]); <span class="comment">// 创建新的locale</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实现了这个组件后，我们需要将这个组件添加到容器中，我们向 <code>config.MyMvcConifg</code> 中添加配置方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后修改我们的login.html文件，为下方的 english， 中文版添加超链接：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/(lang=zh-CN)&#125;"</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/(lang=en-US)&#125;"</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>即可发现现在点击下方的按钮可以切换语言:</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-15-20-54-06.png" /></p>
<h2 id="登录">登录</h2>
<p>我们首先不考虑安全的实现一个简单的登录功能，用户在页面中输入用户名和密码，如果在数据库中存在用户名和密码，则用户登录成功，进入详情页面。否则提示用户登录失败。首先我们修改我们的登录页，添加表单的提交地址，并且为username 和 password 添加 name 属性：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"form-signin"</span> <span class="attr">action</span>=<span class="string">"dashboard.html"</span> <span class="attr">th:action</span>=<span class="string">"@&#123;/api/session&#125;"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">th:placeholder</span>=<span class="string">"#&#123;login.username&#125;"</span> <span class="attr">required</span>=<span class="string">""</span> <span class="attr">autofocus</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">th:placeholder</span>=<span class="string">"#&#123;login.password&#125;"</span> <span class="attr">required</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>接下来在 entity 包下创建 User 类，加上JPA注解以及Getter，Setter：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">// 主键</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(unique = <span class="keyword">true</span>, nullable = <span class="keyword">false</span>) <span class="comment">// 非空，唯一</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(nullable = <span class="keyword">false</span>)</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 Repository 包下创建 UserRepository 接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findByUsername</span><span class="params">(String username)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们在接口里增加了一个方法 <code>findByUsername()</code>，这里的方法名指定了查询条件，对于这个方法，Spring Data JPA 会自动为我们生成相应的查询语句而无需我们做任何实现，具体的方法命名规则参考 <a href="https://docs.spring.io/spring-data/jpa/docs/current/reference/html/#jpa.query-methods.query-creation">官方文档</a>。就此我们的数据访问就已经完成，在application.yml中添加数据库的相应配置以及启用generate-ddl，运行项目，让Spring Data自动为我们在数据库中创建User表。在User表中添加一个用户用于测试：</p>
<p><img src="/img/(2020-06-14)SpringBoot-Web开发.md/2020-06-17-22-27-02.png" /></p>
<p>接下来编写Controller，在controller包下创建 <code>LoginController</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/api"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/session"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span> String username,</span></span><br><span class="line"><span class="function">                        @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password,</span></span><br><span class="line"><span class="function">                        Map&lt;String, String&gt; map)</span>&#123;</span><br><span class="line">        <span class="comment">// 根据用户名获取用户</span></span><br><span class="line">        User loginUser = userRepository.findByUsername(username);</span><br><span class="line">        <span class="comment">// 用户存在 对比密码</span></span><br><span class="line">        <span class="keyword">if</span>(loginUser!= <span class="keyword">null</span> &amp;&amp; loginUser.getPassword().equals(password))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"dashboard"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            map.put(<span class="string">"msg"</span>, <span class="string">"用户名密码错误"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后在 <code>login.html</code> 中的Please Sign in 下添加如下一行，添加密码错误时的错误提示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"color: darkred"</span> <span class="attr">th:text</span>=<span class="string">"$&#123;msg&#125;"</span> <span class="attr">th:if</span>=<span class="string">"$&#123;not #strings.isEmpty(msg)&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>现在尝试登录，访问 <code>localhost:8080</code>，并输入错误的用户名和密码：</p>
<p><img src="img/(2020-06-14)SpringBoot-Web开发.md/2020-06-17-22-34-00.png" /></p>
<p>再尝试正确的密码，发现成功跳转到了dashboard页面。</p>
<h2 id="拦截器">拦截器</h2>
<p>现在如果我们在dashboard界面刷新，你会发现浏览器提示我们是否需要重新提交表单。这是因为刷新时浏览器会重新发送我们登录时的Post请求。为了防止重复提交，我们修改为重定向的方式来让用户到达dashboard页面。观察我们之前的请求，用户登录成功后，浏览器的url栏显示的时我们post地址的url，而修改为重定向后，浏览器则会跳转到我们重定向的url。</p>
<p>首先修改 <code>HelloController</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(loginUser!= <span class="keyword">null</span> &amp;&amp; loginUser.getPassword().equals(password))&#123;</span><br><span class="line">    session.setAttribute(<span class="string">"loginUser"</span>, loginUser.getId());</span><br><span class="line">    <span class="comment">// return "dashboard"</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"redirect:/main"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在用户登录成功后，我们将用户重定向到 <code>/main</code>，也就是说浏览器会向 <code>/main</code> 发送一次请求，因此我们将 dashboard视图绑定到 <code>/main</code>, 修改 <code>MyMvcConfig</code> 配置类中我们之前实现的 <code>WebMvcConfigurator</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">    registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">    registry.addViewController(<span class="string">"/index.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">    <span class="comment">// 重定向 /main 到视图 dashboard</span></span><br><span class="line">    registry.addViewController(<span class="string">"/main"</span>).setViewName(<span class="string">"dashboard"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时再次登录，你会发现浏览器会自动跳转到 <code>localhost:8080/main</code>，并且刷新浏览器也不会再提示需要重新提交表单。但是此时你会发现一个问题，就是如果此时我们在其他浏览器中直接访问 <code>localhost:8080/main</code>，便跳过了登陆直接进入了dashboard，这是我们不希望看到的，因此我们需要拦截那些未登录用户的请求，这里就用到了拦截器。首先我们要做的是识别一个用户的登录状态，修改 <code>LoginContoller</code> 中的 login 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/session"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(@RequestParam(<span class="string">"username"</span>)</span> String username,</span></span><br><span class="line"><span class="function">                    @<span class="title">RequestParam</span><span class="params">(<span class="string">"password"</span>)</span> String password,</span></span><br><span class="line"><span class="function">                    Map&lt;String, String&gt; map,</span></span><br><span class="line"><span class="function">                    <span class="comment">// 传入session</span></span></span><br><span class="line"><span class="function">                    HttpSession session)</span>&#123;</span><br><span class="line">    User loginUser = userRepository.findByUsername(username);</span><br><span class="line">    <span class="keyword">if</span>(loginUser!= <span class="keyword">null</span> &amp;&amp; loginUser.getPassword().equals(password))&#123;</span><br><span class="line">        <span class="comment">// 将登录用户的id保存在session中</span></span><br><span class="line">        session.setAttribute(<span class="string">"loginUser"</span>, loginUser.getId());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"redirect:/main"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        map.put(<span class="string">"msg"</span>, <span class="string">"用户名密码错误"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"login"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>此时我们就可以判断session中是否有 <code>loginUser</code> 这个attribute来判断用户是否登录，接下来我们就可以开始编写我们的拦截器，在 component 包下新建 <code>LoginHandlerInterceptor</code> 类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginHandlerInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 取出 loginUser</span></span><br><span class="line">        Object loginUserId = request.getSession().getAttribute(<span class="string">"loginUser"</span>);</span><br><span class="line">        <span class="keyword">if</span>(loginUserId != <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 若存在，则用户已登录，放行请求</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">// 若不存在，重定向用户到登录页面</span></span><br><span class="line">            request.getRequestDispatcher(<span class="string">"/index.html"</span>).forward(request, response);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该类实现了 <code>HandlerInterceptor</code> 接口，这个接口有三个方法，当容器收到一个请求后，如果满足条件，则会在controller方法执行前先执行 <code>preHandle</code> 方法，该方法的返回值是一个布尔值，代表的是是否拦截该请求。接下来修改配置类，将我们自定义的拦截器添加进容器。修改 <code>MyMvcConfig</code> 类，之前我们在该类中添加了一个返回 <code>WebMvcConfigurator</code> 的方法，我们在该方法中编写了一个 <code>WebMvcConfigurator</code> 的匿名实现类用于重定向的配置，现在我们为这个类添加一个新的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> WebMvcConfigurer <span class="title">webMvcConfigurer</span><span class="params">()</span></span>&#123;</span><br><span class="line">    WebMvcConfigurer webMvcConfigurer = <span class="keyword">new</span> WebMvcConfigurer() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">            registry.addViewController(<span class="string">"/"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">            registry.addViewController(<span class="string">"/index.html"</span>).setViewName(<span class="string">"login"</span>);</span><br><span class="line">            registry.addViewController(<span class="string">"/main"</span>).setViewName(<span class="string">"dashboard"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">            registry.addInterceptor(<span class="keyword">new</span> LoginHandlerInterceptor())</span><br><span class="line">                    <span class="comment">// 拦截所有请求</span></span><br><span class="line">                    .addPathPatterns(<span class="string">"/**"</span>) </span><br><span class="line">                    <span class="comment">// 排除登录页面和登录请求的拦截</span></span><br><span class="line">                    .excludePathPatterns(<span class="string">"/index.html"</span>,<span class="string">"/"</span>,<span class="string">"/api/session"</span>)</span><br><span class="line">                    <span class="comment">// 排除静态资源的拦截</span></span><br><span class="line">                    .excludePathPatterns(<span class="string">"/asserts/**"</span>, <span class="string">"/webjars/**"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> webMvcConfigurer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样未登录的用户就只能登录请求页面和发送登录请求，对于服务器其他url的访问都会被拦截器拦截，并且强制跳转到登录页面。现在，我们再尝试在另一个浏览器访问 <code>localhost:8080/main</code>，会发现直接跳转到了登录界面。</p>
</div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Spring/">Spring</a><a class="link-muted mr-2" rel="tag" href="/tags/SpringBoot/">SpringBoot</a></div><div class="addthis_inline_share_toolbox"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5eebe43792e11671" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/passages/SpringBoot-Web%E5%BC%80%E5%8F%91%EF%BC%88%E4%BA%8C%EF%BC%89/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">SpringBoot-Web开发（二）</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/passages/Spring-%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/"><span class="level-item">SpringBoot 数据访问</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><!--!--><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="Virgil’s Blog" height="28"></a><p class="size-small"><span>&copy; 2020 VirgilChen</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'http://VirgilChen97.github.io',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>